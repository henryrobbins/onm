<!-- index.html â€“ Links a sample bank account. -->
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <script>

      // Grab a Link token to initialize Link
      const createLinkToken = async () => {
        const res = await fetch("/api/create_link_token");
        const data = await res.json();
        const linkToken = data.link_token;
        localStorage.setItem("link_token", linkToken);
        return linkToken;
      };

      // Show Access Token to user
      const showAccessToken = function (accessToken) {
        const pre = document.getElementById("response");
        pre.textContent = accessToken;
        return pre
      };

      (async ($) => {
        // Initialize Link
        const handler = Plaid.create({
          token: await createLinkToken(),
          onSuccess: async (publicToken, metadata) => {
            const res = await fetch("/api/exchange_public_token", {
              method: "POST",
              body: JSON.stringify({ public_token: publicToken }),
              headers: {
                "Content-Type": "application/json",
              },
            });
            const data = await res.json()
            const accessToken = data.access_token
            showAccessToken(accessToken)
          }
        });
        handler.open();
      })(jQuery);
    </script>
  </head>
  <title>onm</title>
  <body>
    <pre
      id="response"
      style="
        font-size: 14px;
        display: inline;
        background-color: #f4f4f4;
        padding: 2px 4px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
      "
    ></pre>
  </body>
</html>
